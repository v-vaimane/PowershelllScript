{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "basics": [
      {
      "name": "mainSection",
      "type": "Microsoft.Common.Section",
      "label": "Deploying resources using ARM template",  
      "elements": [
        {
          "name": "crmOrgId",
          "type": "Microsoft.Common.TextBox",
          "label": "CRM Organization Id",
          "visible": true,
          "constraints": {
            "required": true
          }
        }, 
		{
          "name": "CrmURL",
          "type": "Microsoft.Common.TextBox",
          "label": "CRM Organization URL",
          "visible": true,
          "constraints": {
            "required": true
          }
        },  
          {
            "name": "DeploySimulator",
            "type": "Microsoft.Common.CheckBox",
            "label": "Deploy Simulator",
            "toolTip": "We will deploy new resources to your Azure subscription. To use existing IoT Hub, storage account, or Service Bus resources, select Use existing Azure resources.",
            "visible": true,
	    "defaultValue": "False",  
          },
          {
            "name": "isTimeSeriesInsight",
            "type": "Microsoft.Common.DropDown",
            "label": "Deploy Azure Time Series Insights (optional)",
            "defaultValue": "False",
            "toolTip": "Time Series Insights can be included in your deployment for detailed device insights and analytics.",
            "constraints": {
                "allowedValues": [
                    {
                        "label": "Yes",
                        "value": "Yes"
                    },
                    {
                        "label": "False",
                        "value": "False"
                    }
                ]
            },
            "visible": true
        },
          {
              "name": "ApplicationID",
              "type": "Microsoft.Common.TextBox",
              "label": "Application (client) ID",
              "visible": "[contains(basics('mainSection').isTimeSeriesInsight,'Yes')]",
              "constraints": {
                "required": true
              }
            },
            {
              "name": "ClientSecretID",
              "type": "Microsoft.Common.TextBox",
              "label": "Client Secret",
              "visible": "[contains(basics('mainSection').isTimeSeriesInsight,'Yes')]",
              "constraints": {
                "required": true
              }
            },
        {
              "name": "isPowerBI",
              "type": "Microsoft.Common.DropDown",
              "label": "Deploy SQL Server for Power BI (optional)",
              "defaultValue": "False",
              "toolTip": "Microsoft Power BI for device analytics can be included in your deployment. Choosing this will deploy two additional resources, Azure Streaming Analytics and SQL Server database.",
              "constraints": {
                  "allowedValues": [
                      {
                          "label": "Yes",
                          "value": "Yes"
                      },
                      {
                          "label": "False",
                          "value": "False"
                      }
                  ]
              },
              "visible": true
          },  
          {
              "name": "SQLServer",
              "type": "Microsoft.Solutions.ResourceSelector",
              "label": "SQL Server",
              "resourceType": "Microsoft.Sql/servers",
              "visible": "[contains(basics('mainSection').isPowerBI,'Yes')]",
              "options": {
                "filter": {
                  "subscription": "onBasics",
                  "location": "onBasics"
                }
              }
          },
          {
            "name": "text1",
            "type": "Microsoft.Common.InfoBox",
            "visible": "[contains(basics('mainSection').isPowerBI,'Yes')]",
            "options": {
              "icon": "None",
              "text": "Enter the new username and password for creating the database."
            }
          },
          {
            "name": "administratorLogin",
            "type": "Microsoft.Compute.UserNameTextBox",
            "label": "SQL Server admin username",
            "visible": "[contains(basics('mainSection').isPowerBI,'Yes')]",
            "toolTip": "Make sure your login name meets the following requirements - It's a SQL Identifier, and not a typical system name (like admin, administrator, sa, root, dbmanager, loginmanager, etc.), or a built-in database user or role (like dbo, guest, public, etc.). Make sure your name doesn't contain whitespaces, unicode characters, or nonalphabetic characters, and that it doesn't begin with numbers or symbols.   ",
            "constraints": {
              "required": true,
              "regex": "^[a-z0-9A-Z]{1,30}$",
              "validationMessage": "Only alphanumeric characters are allowed, and the value must be 1-30 characters long."
          },
          "osPlatform": "Windows"
          },
          {
            "name": "administratorLoginPassword",
            "type": "Microsoft.Common.PasswordBox",
            "label": {
            "password": "Password",
            "confirmPassword": "Confirm password"
            },
            "toolTip": "Your password cannot contain all or part of the username. Part of a username is defined as three or more consecutive alphanumeric characters.",
            "visible": "[contains(basics('mainSection').isPowerBI,'Yes')]",
            "constraints": {
              "required": true,

			  "customValidationMessage":"Your password cannot contain all or part of the username. Part of a username is defined as three or more consecutive alphanumeric characters."
              },
            "options": {
                "hideConfirmation": false
            }
          }
      ]
      }
    ],
    "steps": [],
    "outputs": {
      "crmOrgId": "[basics('mainSection').crmOrgId]",
      "CrmURL": "[basics('mainSection').CrmURL]",
      "SQLServer": "[basics('mainSection').SQLServer]",
      "isTimeSeriesInsight": "[basics('mainSection').isTimeSeriesInsight]",
      "ApplicationID": "[basics('mainSection').ApplicationID]",
      "ClientSecretID": "[basics('mainSection').ClientSecretID]",
      "isPowerBI": "[basics('mainSection').isPowerBI]",
      "administratorLogin": "[basics('mainSection').administratorLogin]",
      "administratorLoginPassword": "[basics('mainSection').administratorLoginPassword]"
    }
  }
}
